<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>👑 계시록 통달 챌린지 👑</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="main-ios-style.css">
</head>
<body class="main-body-theme">

    <div id="nickname-area" style="display:none;">
        <div class="rpg-overlay">
            <div class="rpg-card">
                <div class="rpg-header">
                    <div class="rpg-icon">⚔️</div>
                    <h2 class="rpg-main-title">제사장님 성명</h2>
                    <p class="rpg-sub-title">제사장으로 기록될 이름을 정하십시오.</p>
                </div>
                <div class="rpg-input-box">
                    <input type="text" id="user-nickname" placeholder="닉네임 입력 (20자 이하)" maxlength="20">
                    <div class="input-underline"></div>
                </div>
                <div class="rpg-actions">
                    <button class="rpg-btn primary" id="btn-name-start">이름 걸고 시작하기</button>
                    <button class="rpg-btn secondary" id="btn-anon-start">은둔 통달자로 진행</button>
                </div>
            </div>
        </div>
    </div>

    <button id="top-right-plus" class="top-right-btn" onclick="toggleIOSSheet()" style="display:none;">
        <span>+</span>
    </button>

    <div class="container">
        <div id="loading"><div>⏳</div><span>예비 제사장님 업적 불러오는 중...</span></div>

        <div id="main-menu">
            <div class="glass-card dday-card">
                <div class="dday-text">천국고시 통달까지 <span id="dday-count" class="dday-highlight">D-Day</span></div>
                <div class="dday-bar-bg">
                    <div id="dday-bar" class="dday-bar-fill"></div>
                </div>
            </div>

            <div class="ranking-container">
                <h3 class="main-section-title">천국고시 통달 랭킹</h3>
                <div id="ranking-list" class="glass-list">
                    <p style="text-align:center; color:#555; padding:20px;">랭킹 불러오는 중...</p>
                </div>
            </div>
        </div>

        <div id="quarter-menu" style="display:none;">
            <div class="nav-bar-bg">도전 분기 선택</div>
            <div class="quiz-nav-left" onclick="showMain()">
                <span class="nav-btn">〈 홈으로</span>
            </div>
            
            <div class="grid-menu" style="margin-top: 10px;">
                <div class="category-btn" onclick="loadQuarterData('1분기')"><h3>1분기</h3><p>1-6장</p></div>
                <div class="category-btn" onclick="loadQuarterData('2분기')"><h3>2분기</h3><p>7-12장</p></div>
                <div class="category-btn" onclick="loadQuarterData('3분기')"><h3>3분기</h3><p>13-17장</p></div>
                <div class="category-btn" onclick="loadQuarterData('4분기')"><h3>4분기</h3><p>18-22장</p></div>
            </div>
        </div>

        <div id="list-area" style="display:none;">
            <div class="nav-bar-bg">시험 선택</div>
            <div class="quiz-nav-left" onclick="showQuarterMenu()">
                <span class="nav-btn">〈 뒤로</span>
            </div>
            <div id="file-container" style="margin-top: 10px;"></div>
        </div>

        <div id="quiz-area" style="display:none;">
            
            <div id="quiz-title">통달 시험</div> 
            
            <div class="quiz-nav-left" onclick="if(confirm('시험을 중단하시겠습니까?')) showQuarterMenu()">
                <span class="nav-btn">〈 뒤로</span>
            </div>
            
            <button class="top-right-btn" onclick="resetAllQuiz()">
                <span style="font-size: 24px; font-weight: 700;">↻</span>
            </button>

            <div id="quiz-text"></div>
            
            <button class="submit-btn" onclick="submitQuiz()">시험지 제출</button>
        </div>

        <div id="result-area" style="display:none;">
            <div class="quiz-nav-left" style="top: 15px;" onclick="showMain()">
                <span class="nav-btn">〈 홈으로</span>
            </div>

            <div id="capture-target" class="result-header">
                <h2 style="margin: 0 0 5px 0; font-size: 1.1rem; opacity: 0.8;">오늘 암송 인증</h2>
                <div id="score-text"></div>
                <div id="score-msg" style="margin-bottom: 15px;"></div>
                
                <button class="submit-btn primary-action-btn" onclick="autoCaptureAndShare()" data-html2canvas-ignore="true">📸 챌린지 인증하기</button>
                
                <p style="margin-top:10px; font-size:11px; opacity:0.5;">© 청년회 계시록 통달 챌린지</p>
            </div>

            <div id="review-section" style="width: 100%;">
                <h3 style="text-align: center; margin-bottom: 10px; font-size: 1.1rem;">📝 통달 확인 (오답 노트)</h3>
                <div id="review-list"></div>
            </div>
        </div>
    </div>

    <div id="capture-guide" style="display:none;">
        <div class="guide-box">
            <h3>✅ 인증 준비 완료</h3>
            <div id="captured-img-placeholder"></div>
            <button class="submit-btn" onclick="goToChallengeGroup()">🔗 챌린지 방 바로가기</button>
            <button class="submit-btn secondary" onclick="goToStart()">🏠 처음으로</button>
        </div>
    </div>

    <div id="bottom-action-bar" class="bottom-nav-bar glass-nav">
        <button class="fab-plus" onclick="toggleIOSSheet()" style="display:none;"><span>+</span></button>
        <button class="main-pill-btn" onclick="showQuarterMenu()">
            👑 천국고시 암기 시험 바로가기
        </button>
    </div>

    <div id="ios-sheet-overlay" class="sheet-overlay" onclick="toggleIOSSheet()">
        <div class="ios-sheet" onclick="event.stopPropagation()">
            <div class="sheet-handle"></div>
            <div class="sheet-content">
                <h3>통달 도우미 메뉴</h3>
                <div class="sheet-menu-list">
                    <div class="sheet-item" onclick="goToChallengeGroup()">🚀 커뮤니티</div>
                    <div class="sheet-item close" onclick="toggleIOSSheet()">닫기</div>
                </div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="rank.js"></script>
    <script src="heavenlyExam.js"></script>
    <script src="weeklyExam.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const targetDate = new Date('2026-03-28T00:00:00');
            const startDate = new Date('2026-01-01T00:00:00');
            const today = new Date();

            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const ddayText = document.getElementById('dday-count');
            if (ddayText) {
                if (diffDays > 0) ddayText.innerText = "D-" + diffDays;
                else if (diffDays === 0) ddayText.innerText = "D-Day";
                else ddayText.innerText = "D+" + Math.abs(diffDays);
            }

            const totalDuration = targetDate - startDate;
            const elapsedDuration = today - startDate;
            let percentage = (elapsedDuration / totalDuration) * 100;
            if (percentage < 0) percentage = 0;
            if (percentage > 100) percentage = 100;

            setTimeout(() => {
                const ddayBar = document.getElementById('dday-bar');
                if (ddayBar) ddayBar.style.width = percentage + "%";
            }, 500);
        });
    </script>
</body>
</html>