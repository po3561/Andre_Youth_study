<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‘‘ ê³„ì‹œë¡ í†µë‹¬ ì±Œë¦°ì§€ ğŸ‘‘</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="main-ios-style.css">
</head>
<body class="main-body-theme">

    <div id="nickname-area" style="display:none;">
        <div class="rpg-overlay">
            <div class="rpg-card">
                <div class="rpg-header">
                    <div class="rpg-icon">âš”ï¸</div>
                    <h2 class="rpg-main-title">ì œì‚¬ì¥ë‹˜ ì„±ëª…</h2>
                    <p class="rpg-sub-title">ì œì‚¬ì¥ìœ¼ë¡œ ê¸°ë¡ë  ì´ë¦„ì„ ì •í•˜ì‹­ì‹œì˜¤.</p>
                </div>
                <div class="rpg-input-box">

                    <input type="text" id="user-nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥ (20ì ì´í•˜)" maxlength="8">

                    

                    <div class="input-underline"></div>
                </div>
                <div class="rpg-actions">
                    <button class="rpg-btn primary" id="btn-name-start">ë‹‰ë„¤ì„ìœ¼ë¡œ ì‹œì‘í•˜ê¸°</button>
                    <button class="rpg-btn secondary" id="btn-anon-start">ì€ë‘” ê³ ìˆ˜ë¡œ ì‹œì‘</button>
                </div>
            </div>
        </div>
    </div>

    <button id="top-right-plus" class="top-plus-btn" onclick="toggleIOSSheet()" style="display:none;">
        <span>+</span>
    </button>

    <div class="container">
        <div id="loading"><div>â³</div>ì˜ˆë¹„ ì œì‚¬ì¥ë‹˜ ì—…ì  ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

        <div id="main-menu">
            <div class="glass-card dday-card">
                <div class="dday-text">ì²œêµ­ê³ ì‹œ ì‹œí—˜ ê¹Œì§€<span id="dday-count" class="dday-highlight">D-Day</span></div>
                <div class="dday-bar-bg">
                    <div id="dday-bar" class="dday-bar-fill"></div>
                </div>
            </div>

            <div class="ranking-container">
                <h3 class="main-section-title">ì²œêµ­ê³ ì‹œ í†µë‹¬ ë­í‚¹</h3>
                <div id="ranking-list" class="glass-list">
                    <p style="text-align:center; color:#555; padding:20px;">ë­í‚¹ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>

        <div id="quarter-menu" style="display:none;">
            <div class="back-btn" onclick="showMain()">ã€ˆ ë’¤ë¡œ</div>
            <h2>ë¶„ê¸° ì„ íƒ</h2>
            <div class="grid-menu">
                <div class="category-btn" onclick="loadQuarterData('1ë¶„ê¸°')"><h3>1ë¶„ê¸°</h3><p>1-6ì¥</p></div>
                <div class="category-btn" onclick="loadQuarterData('2ë¶„ê¸°')"><h3>2ë¶„ê¸°</h3><p>7-12ì¥</p></div>
                <div class="category-btn" onclick="loadQuarterData('3ë¶„ê¸°')"><h3>3ë¶„ê¸°</h3><p>13-17ì¥</p></div>
                <div class="category-btn" onclick="loadQuarterData('4ë¶„ê¸°')"><h3>4ë¶„ê¸°</h3><p>18-22ì¥</p></div>
            </div>
        </div>

        <div id="list-area" style="display:none;">
            <div class="back-btn" onclick="showQuarterMenu()">ã€ˆ ë’¤ë¡œ</div>
            <div id="file-container"></div>
        </div>

        <div id="quiz-area" style="display:none;">
            <div id="quiz-title"></div>
            <div id="quiz-text"></div>
            <button class="submit-btn" onclick="submitQuiz()">ì‹œí—˜ì§€ ì œì¶œ</button>
        </div>

        <div id="result-area" style="display:none;">
            <div class="quiz-nav" style="justify-content: flex-start; margin-bottom: 5px;">
                <div class="nav-btn" onclick="showMain()">ã€ˆ í™ˆìœ¼ë¡œ</div>
            </div>

            <div id="capture-target" class="result-header">
                <h2 style="margin: 0 0 5px 0; font-size: 1.1rem; opacity: 0.8;">ì˜¤ëŠ˜ ì•”ì†¡ ì¸ì¦</h2>
                <div id="score-text"></div>
                <div id="score-msg" style="margin-bottom: 15px;"></div>
                
                <button class="submit-btn primary-action-btn" onclick="autoCaptureAndShare()" data-html2canvas-ignore="true">ğŸ“¸ ì±Œë¦°ì§€ ì¸ì¦í•˜ê¸°</button>
                
                <p style="margin-top:10px; font-size:11px; opacity:0.5;">Â© ì²­ë…„íšŒ ê³„ì‹œë¡ í†µë‹¬ ì±Œë¦°ì§€</p>
            </div>

            <div id="review-section" style="width: 100%;">
                <h3 style="text-align: center; margin-bottom: 10px; font-size: 1.1rem;">ì˜¤ë‹µí™•ì¸</h3>
                <div id="review-list"></div>
            </div>
        </div>
    </div>

    <div id="capture-guide" style="display:none;">
        <div class="guide-box">
            <h3>âœ… ì¸ì¦ ì¤€ë¹„ ì™„ë£Œ</h3>
            <div id="captured-img-placeholder"></div>
            <button class="submit-btn" onclick="goToChallengeGroup()">ğŸ”— ì±Œë¦°ì§€ ë°© ë°”ë¡œê°€ê¸°</button>
            <button class="submit-btn secondary" onclick="goToStart()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
        </div>
    </div>

    <div id="bottom-action-bar" class="bottom-nav-bar glass-nav">
        <button class="fab-plus" onclick="toggleIOSSheet()"><span>+</span></button>
        <button class="main-pill-btn" onclick="showQuarterMenu()">
            ğŸ‘‘ ì•”ê¸°ì‹œí—˜ì‘ì‹œ
        </button>
    </div>

    <div id="ios-sheet-overlay" class="sheet-overlay" onclick="toggleIOSSheet()">
        <div class="ios-sheet" onclick="event.stopPropagation()">
            <div class="sheet-handle"></div>
            <div class="sheet-content">
                <h3>ë©”ë‰´</h3>
                <div class="sheet-menu-list">
                    <div class="sheet-item" onclick="goToChallengeGroup()">ğŸš€ ì—…ë°ì´íŠ¸ ì˜ˆì •</div>
                    <div class="sheet-item close" onclick="toggleIOSSheet()">ë‹«ê¸°</div>
                </div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="rank.js"></script>
    <script src="heavenlyExam.js"></script>
    <script src="weeklyExam.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 1. ëª©í‘œ ë‚ ì§œ ì„¤ì • (2026ë…„ 3ì›” 28ì¼)
            const targetDate = new Date('2026-03-28T00:00:00');
            // 2. ì‹œì‘ ë‚ ì§œ ì„¤ì • (ì§„í–‰ë¥  ê³„ì‚°ìš©, ì˜ˆ: 2026ë…„ 1ì›” 1ì¼)
            const startDate = new Date('2026-02-01T00:00:00');
            const today = new Date();

            // D-Day í…ìŠ¤íŠ¸ ê³„ì‚°
            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const ddayText = document.getElementById('dday-count');
            if (ddayText) {
                if (diffDays > 0) ddayText.innerText = "D-" + diffDays;
                else if (diffDays === 0) ddayText.innerText = "D-Day";
                else ddayText.innerText = "D+" + Math.abs(diffDays);
            }

            // ê²Œì´ì§€ ë°” í¼ì„¼íŠ¸ ê³„ì‚°
            const totalDuration = targetDate - startDate;
            const elapsedDuration = today - startDate;
            let percentage = (elapsedDuration / totalDuration) * 100;
            
            // 0% ~ 100% ì‚¬ì´ë¡œ ì œí•œ
            if (percentage < 0) percentage = 0;
            if (percentage > 100) percentage = 100;

            // ë°” ë„ˆë¹„ ì ìš© (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°)
            setTimeout(() => {
                const ddayBar = document.getElementById('dday-bar');
                if (ddayBar) {
                    ddayBar.style.width = percentage + "%";
                }
            }, 500);
        });
    </script>
</body>
</html>